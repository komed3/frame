class VideoPlayer{bindings=["F11","Escape","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","f","F","k","K","m","M"," ",",",".","Home","End"];constructor(){this.player=document.getElementById("player"),this.container=document.querySelector(".player-container"),this.videoContainer=this.container.querySelector(".player-inner"),this.video=this.container.querySelector("video"),this.actionContainer=this.container.querySelector(".action-container"),this.controls=this.initControls(),this.previousVolume=1,this.controlsTimeout=null,this.frameRate=30,this.initProgressBar(),this.initEventHandlers(),this.initKeyBindings()}initControls(){const e={};return this.container.querySelectorAll(".player-controls [action]").forEach((t=>{e[t.getAttribute("action")]=t})),e}initProgressBar(){this.progress=this.container.querySelector(".progress-container"),this.progressBar=this.container.querySelector(".progress-bar"),this.bufferBar=this.container.querySelector(".buffer-bar"),this.timeDisplay=this.container.querySelector(".player-time")}initEventHandlers(){document.addEventListener("fullscreenchange",this.updateFullscreenBtn.bind(this)),this.container.addEventListener("mousemove",this.showControls.bind(this)),this.container.addEventListener("mouseleave",this.hideControls.bind(this)),this.actionContainer.addEventListener("click",this.togglePlay.bind(this)),this.actionContainer.addEventListener("dblclick",this.toggleFullscreen.bind(this)),this.controls.play.addEventListener("click",this.play.bind(this)),this.controls.pause.addEventListener("click",this.pause.bind(this)),this.controls.begin.addEventListener("click",this.begin.bind(this)),this.controls.rewind.addEventListener("click",(()=>this.skip(-5))),this.controls.fastForward.addEventListener("click",(()=>this.skip(5))),this.controls.end.addEventListener("click",this.end.bind(this)),this.controls.mute.addEventListener("click",this.mute.bind(this)),this.controls.unmute.addEventListener("click",this.unmute.bind(this)),this.controls.maximize.addEventListener("click",this.maximize.bind(this)),this.controls.minimize.addEventListener("click",this.minimize.bind(this)),this.video.addEventListener("waiting",this.showLoading.bind(this)),this.video.addEventListener("canplay",this.hideLoading.bind(this)),this.video.addEventListener("playing",this.hideLoading.bind(this)),this.video.addEventListener("play",this.updatePlayBtn.bind(this)),this.video.addEventListener("pause",this.updatePlayBtn.bind(this)),this.video.addEventListener("pause",this.showControls.bind(this)),this.video.addEventListener("ended",this.updatePlayBtn.bind(this)),this.video.addEventListener("ended",this.showControls.bind(this)),this.video.addEventListener("volumechange",this.updateVolume.bind(this)),this.video.addEventListener("timeupdate",this.updateProgress.bind(this)),this.video.addEventListener("loadedmetadata",this.updateTimeDisplay.bind(this)),this.video.addEventListener("progress",this.updateBuffer.bind(this))}initKeyBindings(){document.addEventListener("keydown",(e=>{if("input"!==e.target.tagName&&this.bindings.includes(e.key))switch(e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation(),e.key){case" ":case"k":case"K":this.togglePlay();break;case"m":case"M":this.toggleMute();break;case"ArrowLeft":this.skip(-5);break;case"ArrowRight":this.skip(5);break;case"Home":this.begin();break;case"End":this.end();break;case",":this.skipFrame(-1);break;case".":this.skipFrame(1);break;case"F11":case"f":case"F":this.toggleFullscreen();break;case"Escape":this.minimize();break}}))}showControls(){this.container.classList.add("show-controls"),clearTimeout(this.controlsTimeout),this.video.paused||(this.controlsTimeout=setTimeout(this.hideControls.bind(this),3e3))}hideControls(){this.video.paused||this.container.classList.remove("show-controls")}showLoading(){this.container.classList.add("show-spinner")}hideLoading(){this.container.classList.remove("show-spinner")}updateProgress(){const e=this.video.currentTime/this.video.duration*100;this.progressBar.style.setProperty("--width",e+"%"),this.updateTimeDisplay()}updateBuffer(){if(this.video.buffered.length>0){const e=this.video.buffered.end(this.video.buffered.length-1)/this.video.duration*100;this.bufferBar.style.setProperty("--width",e+"%")}}updateTimeDisplay(){const e=formatTime(this.video.currentTime),t=formatTime(this.video.duration);this.timeDisplay.textContent=`${e} / ${t}`}updatePlayBtn(){this.controls.play.disabled=!this.video.paused,this.controls.pause.disabled=this.video.paused}async play(){await this.video.play()}pause(){this.video.pause()}async togglePlay(){this.video.paused?await this.play():this.pause()}isMuted(){return!this.video.volume>0}updateVolume(){const e=this.isMuted();this.controls.mute.disabled=e,this.controls.unmute.disabled=!e}mute(){this.isMuted()||(this.previousVolume=this.video.volume,this.video.volume=0)}unmute(){this.isMuted()&&(this.video.volume=this.previousVolume)}toggleMute(){this.isMuted()?this.unmute():this.mute()}begin(){this.video.currentTime=0}end(){this.video.currentTime=this.video.duration}skip(e){this.video.currentTime=Math.max(0,Math.min(this.video.duration,this.video.currentTime+e))}skipFrame(e){const t=1/this.frameRate;this.pause(),this.video.currentTime=Math.max(0,Math.min(this.video.duration,this.video.currentTime+t*e))}isFullscreen(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement}updateFullscreenBtn(){const e=!!this.isFullscreen();this.controls.maximize.disabled=e,this.controls.minimize.disabled=!e}async maximize(){if(this.isFullscreen())return;const e=this.videoContainer;e.requestFullscreen?await e.requestFullscreen():e.webkitRequestFullscreen?await e.webkitRequestFullscreen():e.mozRequestFullScreen&&await e.mozRequestFullScreen()}async minimize(){this.isFullscreen()&&(document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.mozCancelFullScreen&&await document.mozCancelFullScreen())}async toggleFullscreen(){this.isFullscreen()?await this.minimize():await this.maximize()}}document.addEventListener("DOMContentLoaded",(()=>new VideoPlayer));