class VideoPlayer{constructor(){this.player=document.querySelector(".video-wrapper"),this.video=this.player.querySelector("video"),this.videoId=this.player.getAttribute("videoId"),this.videoDir="/media/"+this.videoId+"/",this.videoBlob=null,this.videoObjectUrl=null,this.videoData={},this.loaded=!1,this.ready=!1,this.loadMeta().then(this.initPlayer.bind(this))}async loadMeta(){if(!this.loaded)try{const t=await fetch("/api/video/"+this.videoId,{method:"post",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error("Error fetching video data");this.videoData=await t.json(),this.loaded=!0}catch(t){throw new Error(t)}}async fetchStream(){if(!this.videoBlob&&!this.videoObjectUrl)try{const t=await fetch(this.videoDir+this.videoData.fileName);if(!t.ok)throw new Error("Failed to fetch the video");this.videoBlob=await t.blob(),this.videoObjectUrl=URL.createObjectURL(this.videoBlob)}catch(t){throw new Error(t)}}async initPlayer(){this.ready||(this.loaded||await this.loadMeta(),await this.fetchStream(),this.video.src=this.videoObjectUrl,this.video.poster=this.videoDir+"poster.jpg",this.video.load(),this.ready=!0)}}document.addEventListener("DOMContentLoaded",(()=>new VideoPlayer));