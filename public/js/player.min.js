class VideoPlayer{bindings=["Escape","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","PageUp","PageDown","Home","End","F1","F6","F7","F8","F9","F10","F11","f","F","k","K","m","M","j","J","l","L","h","H"," ",",",".","+","-","0","1","2","3","4","5","6","7","8","9"];playbackSpeed=[.25,.5,.75,1,1.25,1.5,1.75,2,3,4];constructor(){this.player=document.getElementById("player"),this.container=document.querySelector(".player-container"),this.videoContainer=this.container.querySelector(".player-inner"),this.video=this.container.querySelector("video"),this.actionContainer=this.container.querySelector(".action-container"),this.controls=this.initControls(),this.overlay=this.initOverlay(),this.previousVolume=1,this.frameRate=30,this.controlsTimeout=null,this.overlayTimeout=null,this.initProgressBar(),this.initEventHandlers(),this.initKeyBindings()}initControls(){const e={};return this.container.querySelectorAll("[action]").forEach((t=>{e[t.getAttribute("action")]=t})),e}initOverlay(){const e=this.container.querySelector(".player-overlay");return{icon:e.querySelector("img"),text:e.querySelector("span")}}initProgressBar(){this.progress=this.container.querySelector(".progress-container"),this.progressBar=this.container.querySelector(".progress-bar"),this.bufferBar=this.container.querySelector(".buffer-bar"),this.timeDisplay=this.container.querySelector(".player-time"),this.progress.addEventListener("click",(e=>{const t=this.progress.getBoundingClientRect(),i=(e.clientX-t.left)/t.width;this.seek(i)}))}initEventHandlers(){document.addEventListener("fullscreenchange",this.updateFullscreenBtn.bind(this)),this.container.addEventListener("mousemove",this.showControls.bind(this)),this.container.addEventListener("mouseleave",this.hideControls.bind(this)),this.actionContainer.addEventListener("dblclick",this.toggleFullscreen.bind(this)),this.actionContainer.addEventListener("click",(()=>{this.container.classList.contains("show-settings")||this.container.classList.contains("show-help")?this.container.classList.remove("show-settings","show-help"):this.togglePlay()})),this.controls.play.addEventListener("click",this.play.bind(this)),this.controls.pause.addEventListener("click",this.pause.bind(this)),this.controls.begin.addEventListener("click",this.begin.bind(this)),this.controls.rewind.addEventListener("click",(()=>this.skip(-5))),this.controls.fastForward.addEventListener("click",(()=>this.skip(5))),this.controls.end.addEventListener("click",this.end.bind(this)),this.controls.mute.addEventListener("click",this.mute.bind(this)),this.controls.unmute.addEventListener("click",this.unmute.bind(this)),this.controls.download.addEventListener("click",this.download.bind(this)),this.controls.maximize.addEventListener("click",this.maximize.bind(this)),this.controls.minimize.addEventListener("click",this.minimize.bind(this)),this.controls.settings.addEventListener("click",this.toggleSettings.bind(this)),this.controls.playbackRate.addEventListener("change",(e=>this.setSpeed(e.target.value))),this.controls.help.addEventListener("click",this.toggleHelp.bind(this)),this.controls.volume.addEventListener("input",(e=>{this.setVolume(e.target.value),setTimeout((()=>e.target.blur()),10)})),this.video.addEventListener("waiting",this.showLoading.bind(this)),this.video.addEventListener("canplay",this.hideLoading.bind(this)),this.video.addEventListener("playing",this.hideLoading.bind(this)),this.video.addEventListener("play",this.updatePlayBtn.bind(this)),this.video.addEventListener("pause",this.updatePlayBtn.bind(this)),this.video.addEventListener("pause",this.showControls.bind(this)),this.video.addEventListener("ended",this.updatePlayBtn.bind(this)),this.video.addEventListener("ended",this.showControls.bind(this)),this.video.addEventListener("volumechange",this.updateVolume.bind(this)),this.video.addEventListener("ratechange",this.updateSpeed.bind(this)),this.video.addEventListener("timeupdate",this.updateProgress.bind(this)),this.video.addEventListener("loadedmetadata",this.updateTimeDisplay.bind(this)),this.video.addEventListener("progress",this.updateBuffer.bind(this))}initKeyBindings(){document.addEventListener("keydown",(e=>{if("INPUT"!==e.target.tagName&&this.bindings.includes(e.key))switch(e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation(),e.key){case" ":case"k":case"K":case"F7":this.togglePlay(),this.playOverlay();break;case"m":case"M":case"F9":this.toggleMute(),this.volumeOverlay();break;case"PageUp":this.changeVolume(.4),this.volumeOverlay();break;case"PageDown":this.changeVolume(-.4),this.volumeOverlay();break;case"ArrowUp":this.changeVolume(.1),this.volumeOverlay();break;case"ArrowDown":this.changeVolume(-.1),this.volumeOverlay();break;case"ArrowLeft":case"F6":this.skip(-5),this.seekOverlay();break;case"ArrowRight":case"F8":this.skip(5),this.seekOverlay();break;case"j":case"J":this.skip(-10),this.seekOverlay();break;case"l":case"L":this.skip(10),this.seekOverlay();break;case"Home":this.begin(),this.seekOverlay();break;case"End":this.end(),this.seekOverlay();break;case",":this.skipFrame(-1);break;case".":this.skipFrame(1);break;case"+":this.changeSpeed(.25),this.speedOverlay();break;case"-":this.changeSpeed(-.25),this.speedOverlay();break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":this.seek(10*Number(e.key)),this.seekOverlay();break;case"F11":case"f":case"F":this.toggleFullscreen();break;case"Escape":this.minimize();break;case"h":case"H":case"F1":this.toggleHelp();break}}))}showControls(){this.container.classList.add("show-controls"),clearTimeout(this.controlsTimeout),this.video.paused||(this.controlsTimeout=setTimeout(this.hideControls.bind(this),3e3))}hideControls(){this.video.paused||this.container.classList.remove("show-controls")}showLoading(){this.container.classList.add("show-spinner")}hideLoading(){this.container.classList.remove("show-spinner")}showOverlay(e,t){this.overlay.icon.src="/images/icons/"+e+".svg",this.overlay.text.textContent=t,this.container.classList.add("show-overlay"),clearTimeout(this.overlayTimeout),this.overlayTimeout=setTimeout((()=>this.container.classList.remove("show-overlay")),800)}updateProgress(){const e=this.video.currentTime/this.video.duration*100;this.progressBar.style.setProperty("--width",e+"%"),this.updateTimeDisplay()}updateBuffer(){if(this.video.buffered.length>0){const e=this.video.buffered.end(this.video.buffered.length-1)/this.video.duration*100;this.bufferBar.style.setProperty("--width",e+"%")}}updateTimeDisplay(){const e=formatTime(this.video.currentTime),t=formatTime(this.video.duration);this.timeDisplay.textContent=`${e} / ${t}`}updatePlayBtn(){this.controls.play.disabled=!this.video.paused,this.controls.pause.disabled=this.video.paused}async play(){await this.video.play()}pause(){this.video.pause()}async togglePlay(){this.video.paused?await this.play():this.pause()}playOverlay(){this.video.paused?this.showOverlay("pause","Video paused"):this.showOverlay("play","Video started")}isMuted(){return!this.video.volume>0}updateVolume(){const e=this.isMuted(),t=100*this.video.volume;this.controls.mute.disabled=e,this.controls.unmute.disabled=!e,this.controls.volume.value=t,this.controls.volume.style.setProperty("--width",t+"%")}mute(){this.isMuted()||(this.previousVolume=this.video.volume,this.video.volume=0)}unmute(){this.isMuted()&&(this.video.volume=this.previousVolume||1)}toggleMute(){this.isMuted()?this.unmute():this.mute()}changeVolume(e){this.video.volume=Number(Math.max(0,Math.min(1,this.video.volume+e)).toFixed(1)),this.previousVolume=this.video.volume}setVolume(e){this.video.volume=Number(Math.max(0,Math.min(1,e/100)).toFixed(1)),this.previousVolume=this.video.volume}volumeOverlay(){this.showOverlay(this.isMuted()?"mute":"volume",Math.round(100*this.video.volume)+"%")}begin(){this.video.currentTime=0}end(){this.video.currentTime=this.video.duration}skip(e){this.video.currentTime=Math.max(0,Math.min(this.video.duration,this.video.currentTime+e))}skipFrame(e){const t=1/this.frameRate;this.pause(),this.video.currentTime=Math.max(0,Math.min(this.video.duration,this.video.currentTime+t*e))}seek(e){this.video.currentTime=this.video.duration*Math.max(0,Math.min(1,e>1?e/100:e))}seekOverlay(){this.showOverlay("fastForward","Skip to "+formatTime(this.video.currentTime))}changeSpeed(e){this.setSpeed(this.video.playbackRate+e)}setSpeed(e){this.video.playbackRate=Number(Math.max(.25,Math.min(2,e)).toFixed(2))}updateSpeed(){this.controls.playbackRate.value=this.video.playbackRate}speedOverlay(){this.showOverlay("clock",`Playback rate: ${this.video.playbackRate}x`)}isFullscreen(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement}updateFullscreenBtn(){const e=!!this.isFullscreen();this.controls.maximize.disabled=e,this.controls.minimize.disabled=!e,e?this.showOverlay("maximize","Video in full screen"):this.showOverlay("minimize","Leave full screen")}async maximize(){if(this.isFullscreen())return;const e=this.videoContainer;e.requestFullscreen?await e.requestFullscreen():e.webkitRequestFullscreen?await e.webkitRequestFullscreen():e.mozRequestFullScreen&&await e.mozRequestFullScreen()}async minimize(){this.isFullscreen()&&(document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.mozCancelFullScreen&&await document.mozCancelFullScreen())}async toggleFullscreen(){this.isFullscreen()?await this.minimize():await this.maximize()}toggleSettings(){this.container.classList.remove("show-help"),this.container.classList.toggle("show-settings")}toggleHelp(){this.container.classList.remove("show-settings"),this.container.classList.toggle("show-help")}download(){const e=this.video.currentSrc,t=document.createElement("a");t.href=e,t.download="video.mp4",t.target="_blank",t.click()}}document.addEventListener("DOMContentLoaded",(()=>new VideoPlayer));