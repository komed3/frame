class VideoSearch{constructor(){this.form=document.querySelector(".frame-search--form"),this.loader=document.querySelector(".frame-search--loader"),this.results=document.querySelector(".frame-search--results-grid"),this.empty=document.querySelector(".frame-search--empty"),this.more=document.querySelector(".frame-search--more"),this.query=null,this.offset=0,this.initEventHandlers()}initEventHandlers(){this.form.addEventListener("submit",this.submit.bind(this)),this.form.querySelectorAll("select").forEach((e=>e.addEventListener("change",this.submit.bind(this))))}addVideo(e){if(!e||!e.id)return;const t=document.createElement("a");t.classList.add("frame-videogrid--item"),t.href="/watch/"+e.id,t.setAttribute("title",e.title),t.setAttribute("video",e.id);const{progress:i}=JSON.parse(localStorage.getItem(e.id)??'{"progress":0}');t.style.setProperty("--progress",i+"%"),t.innerHTML=`<img class="frame-videogrid--item-preview" src="/media/${e.id}/${e.thumbnail}" alt= "Thumbnail" /><div class="frame-videogrid--item-overlay"><span>${e.title}</span><time>${formatTime(e.duration)}</time></div><div class="frame-videogrid--item-progress"></div>`,this.results.appendChild(t)}async submit(e){e.preventDefault();const t=Object.fromEntries(new FormData(this.form));if(JSON.stringify(t)===JSON.stringify(this.query))return;this.query=t,this.loader.classList.remove("hidden"),this.more.classList.add("hidden");const i=await fetch("/api/search",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.query)});if(!i.ok)return;const{results:s,total:r,offset:d,limit:a}=await i.json();this.loader.classList.add("hidden"),this.empty.classList[0===r?"remove":"add"]("hidden"),this.more.classList[r>d+a?"remove":"add"]("hidden"),this.results.innerHTML="",s.forEach((e=>this.addVideo(e)))}}document.addEventListener("DOMContentLoaded",(()=>new VideoSearch));