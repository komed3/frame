class VideoSearch{constructor(){this.form=document.querySelector(".frame-search--form"),this.loader=document.querySelector(".frame-search--loader"),this.results=document.querySelector(".frame-search--results-grid"),this.empty=document.querySelector(".frame-search--empty"),this.more=document.querySelector(".frame-search--more"),this.query=null,this.offset=0,this.initEventHandlers()}initEventHandlers(){this.form.addEventListener("submit",this.submit.bind(this)),this.form.querySelectorAll("select").forEach((e=>e.addEventListener("change",this.submit.bind(this)))),this.more.querySelector("button").addEventListener("click",(()=>{this.query.offset=this.offset,this.search()}))}addVideo(e){if(!e||!e.id)return;const t=document.createElement("a");t.classList.add("frame-videogrid--item"),t.href="/watch/"+e.id,t.setAttribute("title",e.title),t.setAttribute("video",e.id);const{progress:s}=JSON.parse(localStorage.getItem(e.id)??'{"progress":0}');t.style.setProperty("--progress",s+"%"),t.innerHTML=`<img class="frame-videogrid--item-preview" src="/media/${e.id}/${e.thumbnail}" alt= "Thumbnail" /><div class="frame-videogrid--item-overlay"><span>${e.title}</span><time>${formatTime(e.duration)}</time></div><div class="frame-videogrid--item-progress"></div>`,this.results.appendChild(t)}async search(){this.loader.classList.remove("hidden"),this.more.classList.add("hidden");const e=await fetch("/api/search",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.query)});if(!e.ok)return;const{results:t,total:s,offset:i,limit:r}=await e.json();this.loader.classList.add("hidden"),this.empty.classList[0===s?"remove":"add"]("hidden"),this.more.classList[s>i+r?"remove":"add"]("hidden"),this.offset=i+r,0===i&&(this.results.innerHTML=""),t.forEach((e=>this.addVideo(e)))}async submit(e){e.preventDefault();const t=Object.fromEntries(new FormData(this.form));JSON.stringify(t)!==JSON.stringify(this.query)&&(this.query=t,this.search())}}document.addEventListener("DOMContentLoaded",(()=>new VideoSearch));